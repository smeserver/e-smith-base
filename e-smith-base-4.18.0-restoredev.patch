diff -Nur -x '*.orig' -x '*.rej' e-smith-base-4.18.0/root/usr/lib/perl5/site_perl/esmith/console/perform_restore.pm mezzanine_patched_e-smith-base-4.18.0/root/usr/lib/perl5/site_perl/esmith/console/perform_restore.pm
--- e-smith-base-4.18.0/root/usr/lib/perl5/site_perl/esmith/console/perform_restore.pm	2007-06-11 20:46:27.000000000 -0600
+++ mezzanine_patched_e-smith-base-4.18.0/root/usr/lib/perl5/site_perl/esmith/console/perform_restore.pm	2007-06-11 20:46:02.000000000 -0600
@@ -25,6 +25,8 @@
          gettext("Do you wish to restore from backup?"),
         );
     return unless $rc == 0;
+    system("/etc/init.d/messagebus", "start");
+    system("/etc/init.d/haldaemon", "start");
     INITIATE_RESTORE:
     ($rc, $choice) = $console->yesno_page
         (
@@ -34,7 +36,11 @@
          text =>
          gettext("Insert memory stick or CDROM containing your backup file, then hit the enter key."),
         );
-    return unless $rc == 0;
+    unless ($rc == 0) {
+        system("/etc/init.d/haldaemon", "stop");
+        system("/etc/init.d/messagebus", "stop");
+        return;
+    }
     sleep(3);
     my @dirs;
     open(FSTAB, "</etc/fstab");
@@ -109,6 +115,9 @@
 	tar xf - > /dev/null ) 2>&1 |
 	dialog --backtitle 'Restoring data' --guage 'Progress' 7 70");
     $db->set_prop("bootstrap-console", "ForceSave", "yes");
+    system("/bin/umount", "$device");
+    system("/etc/init.d/haldaemon", "stop");
+    system("/etc/init.d/messagebus", "stop");
 }
 
 #use esmith::console;
