diff -Nur -x '*.orig' -x '*.rej' e-smith-base-4.18.0/root/usr/lib/perl5/site_perl/esmith/console/perform_backup.pm mezzanine_patched_e-smith-base-4.18.0/root/usr/lib/perl5/site_perl/esmith/console/perform_backup.pm
--- e-smith-base-4.18.0/root/usr/lib/perl5/site_perl/esmith/console/perform_backup.pm	2007-07-01 10:57:41.000000000 -0600
+++ mezzanine_patched_e-smith-base-4.18.0/root/usr/lib/perl5/site_perl/esmith/console/perform_backup.pm	2007-07-01 10:55:48.000000000 -0600
@@ -151,7 +151,7 @@
         );
     return unless $rc == 0;
     sleep(3);
-    my @dirs;
+    my @dirs = ();
     open(FSTAB, "</etc/fstab");
     while (<FSTAB>)
     {
diff -Nur -x '*.orig' -x '*.rej' e-smith-base-4.18.0/root/usr/lib/perl5/site_perl/esmith/console/perform_restore.pm mezzanine_patched_e-smith-base-4.18.0/root/usr/lib/perl5/site_perl/esmith/console/perform_restore.pm
--- e-smith-base-4.18.0/root/usr/lib/perl5/site_perl/esmith/console/perform_restore.pm	2007-07-01 10:57:41.000000000 -0600
+++ mezzanine_patched_e-smith-base-4.18.0/root/usr/lib/perl5/site_perl/esmith/console/perform_restore.pm	2007-07-01 10:57:15.000000000 -0600
@@ -42,7 +42,7 @@
         return;
     }
     sleep(3);
-    my @dirs;
+    my @dirs = ();
     open(FSTAB, "</etc/fstab");
     while (<FSTAB>)
     {
@@ -86,6 +86,7 @@
 
     unless (-f "$device/smeserver.tgz")
     {
+        system("/bin/umount", "$device");
 	($rc, $choice) = $console->message_page
 	    (
 	     title   => gettext("Backup file not found"),
@@ -107,7 +108,10 @@
          "\n\n" .
          gettext("Do you wish to restore from this file?"),
         );
-    goto INITIATE_RESTORE unless ($rc == 0);
+    unless ($rc == 0) {
+        system("/bin/umount", "$device");
+        goto INITIATE_RESTORE;
+    }
     system("/sbin/e-smith/signal-event", "pre-restore");
     system("(cd / ; cat $device/smeserver.tgz |
 	pv -n -s $size |
